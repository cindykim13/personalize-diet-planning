{% extends 'planner/auth_base.html' %}
{% load static %}

{% block title %}Register - Step 1 - CNutrition{% endblock %}

{% block auth_header_actions %}
<a href="{% url 'planner:register' %}" class="auth-header-btn auth-header-btn-secondary auth-header-btn-active">Register</a>
<a href="{% url 'planner:login' %}" class="auth-header-btn auth-header-btn-primary">Login</a>
{% endblock %}

{% block auth_content %}
<div class="auth-header">
    <h1 class="auth-title">Create Your Account</h1>
    <p class="auth-subtitle">Step 1: Personal Details</p>
</div>

<!-- Progress Indicator -->
<div class="wizard-progress">
    <div class="wizard-step active">
        <div class="wizard-step-circle">1</div>
        <div class="wizard-step-label">Personal</div>
    </div>
    <div class="wizard-step">
        <div class="wizard-step-circle">2</div>
        <div class="wizard-step-label">Account</div>
    </div>
</div>

<!-- Form -->
<form method="post" class="auth-form" id="personalDetailsForm">
    {% csrf_token %}
    
    <div class="form-group">
        <label for="{{ form.first_name.id_for_label }}" class="form-label">{{ form.first_name.label }}</label>
        {{ form.first_name }}
        {% if form.first_name.errors %}
            <span class="form-error">{{ form.first_name.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="form-group">
        <label for="{{ form.last_name.id_for_label }}" class="form-label">{{ form.last_name.label }}</label>
        {{ form.last_name }}
        {% if form.last_name.errors %}
            <span class="form-error">{{ form.last_name.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="form-group">
        <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
        {{ form.email }}
        {% if form.email.errors %}
            <span class="form-error">{{ form.email.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="form-group">
        <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">{{ form.date_of_birth.label }}</label>
        {{ form.date_of_birth }}
        {% if form.date_of_birth.errors %}
            <span class="form-error">{{ form.date_of_birth.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="form-group">
        <label class="form-label">{{ form.gender.label }}</label>
        <div class="gender-group">
            {% for choice in form.gender %}
                <div class="gender-option">
                    {{ choice.tag }}
                    <label for="{{ choice.id_for_label }}" class="gender-label">{{ choice.choice_label }}</label>
                </div>
            {% endfor %}
        </div>
        {% if form.gender.errors %}
            <span class="form-error">{{ form.gender.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="form-group">
        <label class="form-label">Phone Number (Optional)</label>
        <div class="phone-input-group">
            <div class="country-code-select">
                <div class="country-code-toggle" id="countryCodeToggle">
                    <span id="countryCodeDisplay">ðŸ‡ºðŸ‡¸ +1</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="country-code-dropdown" id="countryCodeDropdown">
                    <!-- Populated by JavaScript -->
                </div>
                {{ form.country_code }}
            </div>
            {{ form.phone_number }}
        </div>
        {% if form.phone_number.errors %}
            <span class="form-error">{{ form.phone_number.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">
            Continue <i class="fas fa-arrow-right"></i>
        </button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script src="{% static 'planner/js/country_codes.js' %}"></script>
<script>
    // Initialize country code picker
    document.addEventListener('DOMContentLoaded', function() {
        initCountryCodePicker();
    });
</script>
{% endblock %}
